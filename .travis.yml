sudo: false
language: node_js
node_js:
- '10'
- '11'
cache: npm
script:
  - gulp build
jobs:
  include:
    - stage: GitHub Release
      node_js: '11'
      before_deploy:
        # Set up git user name and tag this commit
        - git config --local user.name "Lu√≠s Leite"
        - git config --local user.email "ochii@leite.xyz"
        # write npm version to version.txt file
        - npm run write-version
        # setup vars
        - export GIT_COMMIT_HASH=$(git rev-parse --short=8 HEAD)
        - export GIT_BRANCH=${TRAVIS_PULL_REQUEST_BRANCH:-$TRAVIS_BRANCH}       
        - export SERVER_VERSION=$(cat version.txt)
        - export FILENAME_SUFFIX="$SERVER_VERSION-$GIT_COMMIT_HASH-$GIT_BRANCH"
        - git tag $SERVER_VERSION
        # Pack the transpiled source code
        - tar -zcf "cso2-users-service_$FILENAME_SUFFIX.tar.gz" dist package.json package-lock.json LICENSE README.md
      deploy:
        name: Version $SERVER_VERSION
        provider: releases
        api_key:
          secure: WEdeP3FfmJ1EacPqiJUcaOEyHJZPrukVIB73kAFffTmmnduSykXfmcxgitX5xByAucoY7FV5SjHKzeGqnHOd+aYrm48X+UmCeOgK661oozX+IGxkM0cJsmRhxAOYCqu/UbFA79B0irrD3WnaSqxkZGWJEFjQvrewbmss4X9k3rx2P1Ial7ivgJsFNA+JuK9UX03VLY1EV1X2Q1wiRhVPzrYuJiCJDDNMuEKtr5OiCeZwe/v1ngaGrjWF3Xc1pJ/b8MJwHbeji49OL0tmvLumcBFoUDDt7m+bO/wvjAvgf6vExRCb75BKl1czs2+gEHOD7MnDvfgEPpA0HWvQy30m4genL5AhkP4miIfxtj+IBT3IzoBX15gmQ17WEZMMjqj3IC7OvwOHSVcNBYnMC8FHK0/U+hn6ujKRFBvgGpPtf40zWWmdT+n2mwW0wsR8W7yFfHTULiY5ZQZxZ8ReFZalrifA0l825vutqDyEntKa1z5MGL6tZz8T4wp2MQYgB/8q+CqoUn4YdKbjdERdxp8JUHRE94LddmkbIDC7imA/2PYG2fPlQVyORjVUFpR32Bjv+00IwtmxVwCQnNJtFfOphr3nm6tWQB/khPu0gJ+0Pv/QVnShQ2fl91jo60IptgU97NpIAQUyGhpHleSE5s5EEokU9RMy87xs7y4gt9Uq5T0=
        file: cso2-users-service_$FILENAME_SUFFIX.tar.gz
        skip_cleanup: true
        overwrite: true